{% extends 'layout/app_layout.html.twig' %}

{% block page_title %}
    Dashboard Global MIDDO
{% endblock %}

{% block page_subtitle %}
    Vue unifi√©e : Achats, Transport, Banque, Juridique
{% endblock %}

{% block page_actions %}
    <button class="btn btn-primary">Rafra√Æchir</button>
{% endblock %}

{% block page_content %}

<div class="global-dashboard">

    {# --- Achats --- #}
    <section class="dashboard-section">
        <h2>üõí Centre d‚ÄôAchat ‚Äî Commandes r√©centes</h2>

        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Groupe</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Vue client</th>
                </tr>
            </thead>
            <tbody>
                {% for o in orders|slice(0,10) %}
                    <tr>
                        <td>{{ o.id }}</td>
                        <td>{{ o.group.productName ?? '‚Äî' }}</td>
                        <td>{{ o.totalPrice }} ‚Ç¨</td>
                        <td>{{ o.status ?? '‚Äî' }}</td>
                        <td>
                            <a href="{{ path('client_order_view', {id: o.id}) }}" class="btn btn-sm btn-info">
                                D√©tails
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <hr class="section-separator">

    {# --- Transport --- #}
    <section class="dashboard-section">
        <h2>üöö Transport ‚Äî Livraisons & segments</h2>

        <div class="transport-grid">
            <div>
                <h3>Livraisons</h3>
                <ul>
                    {% for d in deliveries|slice(0,10) %}
                        <li>
                            #{{ d.id }} ‚Äî {{ d.pickupLocation }} ‚Üí {{ d.dropLocation }} ({{ d.status }})
                            ‚Äî <a href="/track/{{ d.publicTrackingCode }}">Suivi public</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>

            <div>
                <h3>Segments r√©cents</h3>
                <ul>
                    {% for s in segments|slice(0,10) %}
                        <li>
                            Segment #{{ s.id }} ‚Äî {{ s.fromLocation }} ‚Üí {{ s.toLocation }}
                            ‚Äî {{ s.mode }} ‚Äî {{ s.status }} ‚Äî {{ s.segmentPrice }} ‚Ç¨
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </section>

    <hr class="section-separator">

    {# --- Banque --- #}
    <section class="dashboard-section">
        <h2>üè¶ Banque ‚Äî Transactions r√©centes</h2>

        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>Montant</th>
                    <th>Status</th>
                    <th>R√©f√©rence</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% for t in transactions|slice(0,10) %}
                    <tr>
                        <td>{{ t.id }}</td>
                        <td>{{ t.type }}</td>
                        <td>{{ t.amount }} ‚Ç¨</td>
                        <td>{{ t.status }}</td>
                        <td>{{ t.referenceType }} #{{ t.referenceId }}</td>
                        <td>{{ t.createdAt|date('d/m/Y H:i') }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <hr class="section-separator">

    {# --- Juridique --- #}
    <section class="dashboard-section">
        <h2>‚öñÔ∏è Juridique ‚Äî Contrats logistiques</h2>

        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Segment</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Voir</th>
                </tr>
            </thead>
            <tbody>
                {% for c in contracts|slice(0,10) %}
                    <tr>
                        <td>{{ c.id }}</td>
                        <td>Segment #{{ c.segment.id }}</td>
                        <td>{{ c.status }}</td>
                        <td>{{ c.createdAt|date('d/m/Y H:i') }}</td>
                        <td>
                            <a href="{{ path('logistic_contract_show', {id: c.segment.id}) }}" class="btn btn-sm btn-info">
                                Contrat
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <hr class="section-separator">

    {# --- Liens rapides --- #}
    <section class="dashboard-section">
        <h2>üß© Liens rapides</h2>
        <ul>
            <li><a href="{{ path('transport_dashboard') }}">Dashboard Transport</a></li>
            <li><a href="{{ path('bank_dashboard') }}">Dashboard Banque</a></li>
            <li><a href="{{ path('legal_dashboard') }}">Dashboard Juridique</a></li>
        </ul>
    </section>

</div>

{% endblock %}
